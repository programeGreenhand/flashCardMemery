import{_ as F,j as v,c as i,k as N,y as V,h as j,a as o,d as y,b as s,t as a,F as k,m as w,n as b,D as M,s as g,A as q,o as l}from"./index-DYN_J6N2.js";import{u as U}from"./study-CUwUs_JI.js";import{a as X,u as J}from"./card-DfiZIG2I.js";const K={class:"study-container"},O={key:0,class:"start-study"},Q={class:"study-options"},W={class:"deck-options"},Y=["onClick"],Z={class:"deck-stats"},ss={key:1,class:"study-completed"},es={class:"session-summary"},ts={class:"progress-bar"},as={key:2,class:"flashcard-study"},ns={class:"progress-indicator"},os={class:"flashcard-inner"},ls=["innerHTML"],rs=["innerHTML"],ds={class:"rating-buttons"},us=["onClick"],is={class:"card-tags"},cs={class:"reward-content"},vs={class:"reward-xp"},ps={__name:"Study",setup(ms){const L=V(),P=q(),n=U();X();const $=J(),_=v(!1),d=i(()=>n.currentSession),p=i(()=>n.getCurrentCard()),x=i(()=>n.dueCards),I=i(()=>$.allDecks),R=i(()=>n.todayLearned),S=i(()=>n.todayProgress),D=i(()=>n.dailyGoal),T=[{value:0,label:"完全不记得"},{value:1,label:"不记得"},{value:2,label:"有点记得"},{value:3,label:"记得但有困难"},{value:4,label:"记得"},{value:5,label:"完全记得"}];let m=v("");N(()=>{const r=L.params.deckId;r&&h(r)});function h(r=null){const e=n.startStudySession(r);_.value=!0,e===0&&(d.value.completed=!0)}function H(){n.showAnswer()}function z(){n.resetSession(),_.value=!1,P.push("/study")}function B(){m.value=`https://api.mtyqx.cn/api/random.php?t=${Date.now()}`,console.log(m)}const u=j(),c=v(!1),C=v(""),A=v(0);function G(r){if(n.answerCard(r),r>=3){u.addPoints(10,"正确回答卡片"),u.updateStreak();const e=n.studyStats.totalReviews;if(e===1?u.unlockAchievement("first_review","初次复习","完成首次卡片复习"):e===10?(u.unlockAchievement("review_10","复习入门","复习10张卡片"),f("成就解锁: 复习入门",50)):e===100?(u.unlockAchievement("review_100","复习专家","复习100张卡片"),f("成就解锁: 复习专家",100)):e===1e3&&(u.unlockAchievement("review_1000","复习大师","复习1000张卡片"),f("成就解锁: 复习大师",200)),Math.random()<.2){const t=Math.floor(Math.random()*10)+5;f("连续正确回答，获得额外奖励！",t)}}else u.addPoints(3,"学习尝试");d.value.completed&&u.addPoints(20,"完成学习会话")}function f(r,e){C.value=r,A.value=e,c.value=!0,u.addExperience(e),setTimeout(()=>{c.value=!1},3e3)}return(r,e)=>(l(),o("div",K,[!d.value.cards.length&&!_.value?(l(),o("div",O,[e[5]||(e[5]=s("h2",null,"开始学习",-1)),s("div",Q,[s("div",{class:"study-option",onClick:e[0]||(e[0]=t=>h())},[e[3]||(e[3]=s("h3",null,"学习所有待复习卡片",-1)),s("p",null,"今日待复习: "+a(x.value.length)+" 张卡片",1)]),s("div",W,[e[4]||(e[4]=s("h3",null,"选择卡片集学习",-1)),(l(!0),o(k,null,w(I.value,t=>(l(),o("div",{key:t.id,class:"deck-option",onClick:E=>h(t.id)},[s("h4",null,a(t.title),1),s("p",null,a(t.description),1),s("div",Z," 共 "+a(t.cardsCount)+" 张卡片 ",1)],8,Y))),128))])])])):d.value.completed?(l(),o("div",ss,[e[6]||(e[6]=s("h2",null,"学习完成!",-1)),s("div",es,[s("p",null,"本次学习了 "+a(d.value.cards.length)+" 张卡片",1),s("div",ts,[s("div",{class:"progress-bar-inner",style:b({width:S.value+"%"})},null,4)]),s("p",null,"今日进度: "+a(R.value)+" / "+a(D.value)+" ("+a(S.value)+"%)",1)]),s("button",{class:"primary-button",onClick:z},"继续学习")])):p.value?(l(),o("div",as,[s("div",ns,a(d.value.currentIndex+1)+" / "+a(d.value.cards.length),1),s("div",{class:g(["flashcard",{flipped:d.value.showAnswer}])},[s("div",os,[s("div",{class:"flashcard-front",style:b({backgroundImage:`url(${M(m)})`})},[s("div",{class:"card-content",innerHTML:p.value.front},null,8,ls),d.value.showAnswer?y("",!0):(l(),o("button",{key:0,class:"show-answer-btn",onClick:e[1]||(e[1]=t=>(H(),B()))}," 显示答案 "))],4),s("div",{class:"flashcard-back",style:b({backgroundImage:`url(${M(m)})`})},[s("div",{class:"card-content",innerHTML:p.value.back},null,8,rs),s("div",ds,[(l(),o(k,null,w(T,t=>s("button",{key:t.value,class:g(["rating-btn","rating-"+t.value]),onClick:E=>G(t.value)},a(t.label),11,us)),64))])],4)])],2),s("div",is,[(l(!0),o(k,null,w(p.value.tags,t=>(l(),o("span",{key:t,class:"tag"},a(t),1))),128))])])):y("",!0),c.value?(l(),o("div",{key:3,class:g(["reward-popup",{active:c.value}])},[s("div",cs,[e[7]||(e[7]=s("div",{class:"reward-icon"},"🎉",-1)),e[8]||(e[8]=s("h3",null,"获得奖励！",-1)),s("p",null,a(C.value),1),s("div",vs,"+"+a(A.value)+" XP",1),s("button",{class:"reward-close-btn",onClick:e[2]||(e[2]=t=>c.value=!1)},"继续学习")])],2)):y("",!0)]))}},ys=F(ps,[["__scopeId","data-v-b9d87433"]]);export{ys as default};

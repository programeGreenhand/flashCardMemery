import{_ as R,h as W,i as X,j as c,k as Y,c as L,a,b as t,d as I,g as _,l as w,v as T,F as x,m as $,t as d,p as Z,q as S,r as ee,o as n,s as K,x as B,w as P}from"./index-DYN_J6N2.js";import{u as te,a as se}from"./card-DfiZIG2I.js";const oe={class:"deck-list-container"},le={class:"page-header"},ae={class:"search-filter"},ne={class:"search-box"},ie={class:"tag-filter"},de=["onClick"],re={key:0,class:"loading-container"},ce={key:1,class:"empty-state"},ue={key:2,class:"decks-grid"},ve={class:"deck-header"},pe={class:"deck-actions"},ke=["onClick"],fe=["onClick"],ge={class:"deck-description"},me={class:"deck-meta"},Ce={class:"deck-stats"},_e={class:"stat"},be={class:"stat-value"},ye={class:"stat"},De={class:"stat-value"},he={class:"stat"},we={class:"stat-value"},Te={class:"deck-tags"},xe={class:"deck-actions-footer"},$e={class:"modal-header"},Se={class:"modal-body"},Me={class:"form-group"},Ve={class:"form-group"},Le={class:"form-group"},Be={class:"tag-input-container"},Pe=["onKeydown"],Ee=["disabled"],Fe={class:"selected-tags"},Ne=["onClick"],Ue={class:"modal-footer"},Ie=["disabled"],Ke={class:"modal-header"},qe={class:"modal-body"},Ae={class:"modal-footer"},je={__name:"DeckList",setup(ze){const b=te(),v=se(),M=W(),{showToast:m}=X(),V=c(!0),y=c(""),p=c([]),C=c(!1),k=c(!1),D=c(!1),f=c(null),l=c({title:"",description:"",tags:[]}),g=c("");Y(async()=>{try{setTimeout(()=>{V.value=!1},500)}catch(o){console.error("加载卡片集失败",o),V.value=!1}});const E=L(()=>b.allDecks),q=L(()=>{const o=new Set;return E.value.forEach(e=>{e.tags.forEach(i=>o.add(i))}),[...o]}),F=L(()=>E.value.filter(o=>{const e=o.title.toLowerCase().includes(y.value.toLowerCase())||o.description.toLowerCase().includes(y.value.toLowerCase()),i=p.value.length===0||p.value.every(u=>o.tags.includes(u));return e&&i}));function A(o){const e=p.value.indexOf(o);e===-1?p.value.push(o):p.value.splice(e,1)}function N(){const o=g.value.trim();o&&!l.value.tags.includes(o)&&(l.value.tags.push(o),g.value="")}function j(o){l.value.tags.splice(o,1)}function z(o){D.value=!0,l.value={title:o.title,description:o.description,tags:[...o.tags]},C.value=!0}function G(){if(l.value.title.trim())try{if(D.value)b.updateDeck(f.value.id,l.value),m("卡片集已更新","success"),M.addPoints(5,"修改卡片集");else{const o=b.addDeck(l.value);m("创建卡片集成功","success"),M.addPoints(20,"创建新卡片集"),M.unlockAchievement("first_deck","卡片收藏家","创建第一个卡片集")}h()}catch(o){console.error("保存卡片集失败",o),m("保存失败，请重试","error")}}function O(o){f.value=o,k.value=!0}function Q(){try{v.getCardsByDeck(f.value.id).forEach(e=>{v.deleteCard(e.id)}),b.deleteDeck(f.value.id),k.value=!1,f.value=null,m("卡片集已删除","success")}catch(o){console.error("删除卡片集失败",o),m("删除失败，请重试","error")}}function h(){C.value=!1,D.value=!1,l.value={title:"",description:"",tags:[]},g.value=""}function H(o){return U(o)>0}function U(o){const e=new Date;return v.getCardsByDeck(o).filter(u=>{const s=v.getCardProgress(u.id);return s.dueDate?new Date(s.dueDate)<=e:!0}).length}function J(o){const e=v.getCardsByDeck(o);if(e.length===0)return 0;const i=e.filter(u=>{const s=v.getCardProgress(u.id);return s.repetitions>=3&&s.easeFactor>2});return Math.round(i.length/e.length*100)}return(o,e)=>{var u;const i=ee("router-link");return n(),a("div",oe,[t("div",le,[e[12]||(e[12]=t("h1",null,"我的卡片集",-1)),t("button",{class:"add-deck-btn",onClick:e[0]||(e[0]=s=>C.value=!0)},e[11]||(e[11]=[t("span",{class:"icon"},"+",-1),_(" 新建卡片集 ")]))]),t("div",ae,[t("div",ne,[w(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s),placeholder:"搜索卡片集...",class:"search-input"},null,512),[[T,y.value]])]),t("div",ie,[(n(!0),a(x,null,$(q.value,s=>(n(),a("span",{key:s,class:K(["filter-tag",{active:p.value.includes(s)}]),onClick:r=>A(s)},d(s),11,de))),128))])]),V.value?(n(),a("div",re,e[13]||(e[13]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"加载中...",-1)]))):F.value.length===0?(n(),a("div",ce,[e[14]||(e[14]=t("div",{class:"empty-icon"},"📚",-1)),e[15]||(e[15]=t("h3",null,"还没有卡片集",-1)),e[16]||(e[16]=t("p",null,"创建您的第一个卡片集开始学习之旅吧！",-1)),t("button",{class:"primary-btn",onClick:e[2]||(e[2]=s=>C.value=!0)},"创建卡片集")])):(n(),a("div",ue,[(n(!0),a(x,null,$(F.value,s=>(n(),a("div",{key:s.id,class:K(["deck-card",{"has-due-cards":H(s.id)}])},[t("div",ve,[B(i,{to:`/decks/${s.id}`,class:"deck-title"},{default:P(()=>[_(d(s.title),1)]),_:2},1032,["to"]),t("div",pe,[t("button",{class:"deck-action-btn",onClick:r=>z(s)}," ✏️ ",8,ke),t("button",{class:"deck-action-btn",onClick:r=>O(s)}," 🗑️ ",8,fe)])]),t("p",ge,d(s.description),1),t("div",me,[t("div",Ce,[t("div",_e,[t("span",be,d(s.cardsCount),1),e[17]||(e[17]=t("span",{class:"stat-label"},"卡片",-1))]),t("div",ye,[t("span",De,d(U(s.id)),1),e[18]||(e[18]=t("span",{class:"stat-label"},"待复习",-1))]),t("div",he,[t("span",we,d(J(s.id))+"%",1),e[19]||(e[19]=t("span",{class:"stat-label"},"掌握率",-1))])]),t("div",Te,[(n(!0),a(x,null,$(s.tags,r=>(n(),a("span",{key:r,class:"tag"},d(r),1))),128))])]),t("div",xe,[B(i,{to:`/decks/${s.id}`,class:"deck-btn"},{default:P(()=>e[20]||(e[20]=[_(" 查看 ")])),_:2},1032,["to"]),B(i,{to:`/study/${s.id}`,class:"deck-btn primary"},{default:P(()=>e[21]||(e[21]=[_(" 学习 ")])),_:2},1032,["to"])])],2))),128))])),C.value?(n(),a("div",{key:3,class:"modal-overlay",onClick:h},[t("div",{class:"modal-container",onClick:e[6]||(e[6]=S(()=>{},["stop"]))},[t("div",$e,[t("h2",null,d(D.value?"编辑卡片集":"创建新卡片集"),1),t("button",{class:"close-btn",onClick:h},"×")]),t("div",Se,[t("div",Me,[e[22]||(e[22]=t("label",{for:"deckTitle"},"标题",-1)),w(t("input",{type:"text",id:"deckTitle","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.title=s),class:"form-control",placeholder:"卡片集标题",required:""},null,512),[[T,l.value.title]])]),t("div",Ve,[e[23]||(e[23]=t("label",{for:"deckDescription"},"描述",-1)),w(t("textarea",{id:"deckDescription","onUpdate:modelValue":e[4]||(e[4]=s=>l.value.description=s),class:"form-control",placeholder:"卡片集描述",rows:"3"},null,512),[[T,l.value.description]])]),t("div",Le,[e[24]||(e[24]=t("label",{for:"deckTags"},"标签",-1)),t("div",Be,[w(t("input",{type:"text",id:"deckTags","onUpdate:modelValue":e[5]||(e[5]=s=>g.value=s),onKeydown:Z(S(N,["prevent"]),["enter"]),class:"form-control tag-input",placeholder:"输入标签并按回车"},null,40,Pe),[[T,g.value]]),t("button",{class:"add-tag-btn",onClick:S(N,["prevent"]),disabled:!g.value.trim()}," 添加 ",8,Ee)]),t("div",Fe,[(n(!0),a(x,null,$(l.value.tags,(s,r)=>(n(),a("span",{key:r,class:"tag"},[_(d(s)+" ",1),t("button",{class:"remove-tag-btn",onClick:Ge=>j(r)},"×",8,Ne)]))),128))])])]),t("div",Ue,[t("button",{class:"secondary-btn",onClick:h},"取消"),t("button",{class:"primary-btn",onClick:G,disabled:!l.value.title.trim()}," 保存 ",8,Ie)])])])):I("",!0),k.value?(n(),a("div",{key:4,class:"modal-overlay",onClick:e[10]||(e[10]=s=>k.value=!1)},[t("div",{class:"modal-container delete-modal",onClick:e[9]||(e[9]=S(()=>{},["stop"]))},[t("div",Ke,[e[25]||(e[25]=t("h2",null,"确认删除",-1)),t("button",{class:"close-btn",onClick:e[7]||(e[7]=s=>k.value=!1)},"×")]),t("div",qe,[t("p",null,'确定要删除卡片集 "'+d((u=f.value)==null?void 0:u.title)+'" 吗？',1),e[26]||(e[26]=t("p",{class:"warning"},"此操作无法撤销，包含的所有卡片也将被删除。",-1))]),t("div",Ae,[t("button",{class:"secondary-btn",onClick:e[8]||(e[8]=s=>k.value=!1)},"取消"),t("button",{class:"danger-btn",onClick:Q},"删除")])])])):I("",!0)])}}},He=R(je,[["__scopeId","data-v-d1322612"]]);export{He as default};

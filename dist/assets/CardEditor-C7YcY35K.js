import{_ as F,h as J,i as N,c as j,y as q,j as u,k as X,A as K,a as n,b as e,d as L,t as b,l as I,z as O,F as w,m as M,v as Z,p as tt,q as S,o as i,g as et,s as st,C as lt}from"./index-DYN_J6N2.js";import{a as at,u as ot}from"./card-DfiZIG2I.js";const nt={class:"card-editor-container"},it={class:"page-header"},dt={class:"header-actions"},rt=["disabled"],ut={class:"card-form"},ct={class:"form-group"},vt=["value"],bt={class:"editor-container"},mt={class:"editor-side"},ft={class:"form-group"},pt={class:"editor-toolbar"},kt={class:"editor-preview"},It=["innerHTML"],gt={class:"editor-side"},yt={class:"form-group"},Ct={class:"editor-toolbar"},wt={class:"editor-preview"},Mt=["innerHTML"],_t={class:"form-group"},ht={class:"tag-input-container"},Bt=["onKeydown"],Tt=["disabled"],jt={class:"selected-tags"},Zt=["onClick"],St={class:"form-group difficulty-group"},$t={class:"difficulty-options"},At=["value"],Ht={class:"difficulty-icon"},Wt={class:"difficulty-label"},xt={class:"modal-header"},Lt={class:"modal-body"},Pt={class:"media-upload"},Rt={key:0,class:"image-preview"},Ut=["src"],Dt={class:"media-library"},Gt={class:"media-grid"},Qt=["onClick"],Vt=["src"],zt={class:"modal-footer"},Et=["disabled"],Yt={__name:"CardEditor",setup(Ft){const $=q(),_=K(),g=at(),P=ot(),m=J(),{showToast:h}=N(),R=j(()=>P.allDecks),B=$.params.id,T=j(()=>!!B),y=u(!1),a=u({deckId:$.query.deckId||"",front:"",back:"",tags:[],difficulty:"medium",mediaAttachments:[]}),f=u(""),U=[{value:"easy",label:"简单",icon:"😊"},{value:"medium",label:"中等",icon:"🤔"},{value:"hard",label:"困难",icon:"😰"}],v=u(!1),A=u("front"),c=u(""),p=u(""),D=u(["data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2U5ZTllOSIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2NjY2NjYiPuWbvueJh+ekuuS+izE8L3RleHQ+PC9zdmc+","data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2U1ZjJmZiIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2NjY2NjYiPuWbvueJh+ekuuS+izI8L3RleHQ+PC9zdmc+"]),H=j(()=>a.value.deckId&&a.value.front.trim()!==""&&a.value.back.trim()!=="");X(()=>{if(T.value){const l=g.getCardById(B);l?a.value={deckId:l.deckId,front:l.front,back:l.back,tags:[...l.tags],difficulty:l.difficulty||"medium",mediaAttachments:[...l.mediaAttachments||[]]}:_.push("/decks")}});async function G(){if(H.value){y.value=!0;try{if(T.value)g.updateCard(B,a.value),h("卡片已更新","success"),m.addPoints(5,"更新卡片");else{const l=g.addCard(a.value);h("卡片创建成功","success"),m.addPoints(10,"创建新卡片");const t=g.allCards.length;t===1?m.unlockAchievement("first_card","记忆起步","创建第一张卡片"):t===10?m.unlockAchievement("ten_cards","记忆新手","创建10张卡片"):t===50&&m.unlockAchievement("fifty_cards","记忆达人","创建50张卡片")}_.push(`/decks/${a.value.deckId}`)}catch(l){console.error("保存卡片失败",l),h("保存失败，请重试","error")}finally{y.value=!1}}}function Q(){_.back()}function W(){const l=f.value.trim();l&&!a.value.tags.includes(l)&&(a.value.tags.push(l),f.value="")}function V(l){a.value.tags.splice(l,1)}function d(l,t){const s=document.getElementById(t==="front"?"cardFront":"cardBack");if(!s)return;const o=s.selectionStart,C=s.selectionEnd,k=a.value[t].substring(o,C);let r="";switch(l){case"bold":r=`<strong>${k}</strong>`;break;case"italic":r=`<em>${k}</em>`;break;case"underline":r=`<u>${k}</u>`;break;case"code":r=`<code>${k}</code>`;break;default:r=k}a.value[t]=a.value[t].substring(0,o)+r+a.value[t].substring(C),setTimeout(()=>{s.focus(),s.setSelectionRange(o+r.length,o+r.length)},0)}function x(l){A.value=l,v.value=!0,c.value="",p.value=""}function z(l){const t=l.target.files[0];if(!t)return;const s=new FileReader;s.onload=o=>{c.value=o.target.result,p.value=""},s.readAsDataURL(t)}function E(l){p.value=l,c.value=""}function Y(){const l=c.value||p.value;if(!l)return;const t=`<img src="${l}" alt="附件" style="max-width: 100%;" />`;a.value[A.value]+=t,a.value.mediaAttachments.includes(l)||a.value.mediaAttachments.push(l),v.value=!1}return(l,t)=>(i(),n("div",nt,[e("div",it,[e("h1",null,b(T.value?"编辑卡片":"创建新卡片"),1),e("div",dt,[e("button",{class:"secondary-btn",onClick:Q},"取消"),e("button",{class:"primary-btn",onClick:G,disabled:!H.value||y.value},b(y.value?"保存中...":"保存卡片"),9,rt)])]),e("div",ut,[e("div",ct,[t[20]||(t[20]=e("label",{for:"deckSelect"},"选择卡片集",-1)),I(e("select",{id:"deckSelect","onUpdate:modelValue":t[0]||(t[0]=s=>a.value.deckId=s),class:"form-control",required:""},[t[19]||(t[19]=e("option",{value:"",disabled:""},"请选择卡片集",-1)),(i(!0),n(w,null,M(R.value,s=>(i(),n("option",{key:s.id,value:s.id},b(s.title),9,vt))),128))],512),[[O,a.value.deckId]])]),e("div",bt,[e("div",mt,[e("div",ft,[t[21]||(t[21]=e("label",{for:"cardFront"},"卡片正面 (问题)",-1)),e("div",pt,[e("button",{onClick:t[1]||(t[1]=s=>d("bold","front")),class:"toolbar-btn",title:"加粗"},"B"),e("button",{onClick:t[2]||(t[2]=s=>d("italic","front")),class:"toolbar-btn",title:"斜体"},"I"),e("button",{onClick:t[3]||(t[3]=s=>d("underline","front")),class:"toolbar-btn",title:"下划线"},"U"),e("button",{onClick:t[4]||(t[4]=s=>d("code","front")),class:"toolbar-btn",title:"代码"},"{'}'}"),e("button",{onClick:t[5]||(t[5]=s=>x("front")),class:"toolbar-btn",title:"添加图片"},"🖼️")]),I(e("textarea",{id:"cardFront","onUpdate:modelValue":t[6]||(t[6]=s=>a.value.front=s),class:"form-control editor-textarea",placeholder:"输入问题...",rows:"8",required:""},null,512),[[Z,a.value.front]])]),e("div",kt,[t[22]||(t[22]=e("h3",null,"预览",-1)),e("div",{class:"preview-content",innerHTML:a.value.front},null,8,It)])]),e("div",gt,[e("div",yt,[t[23]||(t[23]=e("label",{for:"cardBack"},"卡片背面 (答案)",-1)),e("div",Ct,[e("button",{onClick:t[7]||(t[7]=s=>d("bold","back")),class:"toolbar-btn",title:"加粗"},"B"),e("button",{onClick:t[8]||(t[8]=s=>d("italic","back")),class:"toolbar-btn",title:"斜体"},"I"),e("button",{onClick:t[9]||(t[9]=s=>d("underline","back")),class:"toolbar-btn",title:"下划线"},"U"),e("button",{onClick:t[10]||(t[10]=s=>d("code","back")),class:"toolbar-btn",title:"代码"},"{'}'}"),e("button",{onClick:t[11]||(t[11]=s=>x("back")),class:"toolbar-btn",title:"添加图片"},"🖼️")]),I(e("textarea",{id:"cardBack","onUpdate:modelValue":t[12]||(t[12]=s=>a.value.back=s),class:"form-control editor-textarea",placeholder:"输入答案...",rows:"8",required:""},null,512),[[Z,a.value.back]])]),e("div",wt,[t[24]||(t[24]=e("h3",null,"预览",-1)),e("div",{class:"preview-content",innerHTML:a.value.back},null,8,Mt)])])]),e("div",_t,[t[25]||(t[25]=e("label",null,"标签",-1)),e("div",ht,[I(e("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=s=>f.value=s),onKeydown:tt(S(W,["prevent"]),["enter"]),class:"form-control tag-input",placeholder:"输入标签并按回车"},null,40,Bt),[[Z,f.value]]),e("button",{class:"add-tag-btn",onClick:S(W,["prevent"]),disabled:!f.value.trim()}," 添加 ",8,Tt)]),e("div",jt,[(i(!0),n(w,null,M(a.value.tags,(s,o)=>(i(),n("span",{key:o,class:"tag"},[et(b(s)+" ",1),e("button",{class:"remove-tag-btn",onClick:C=>V(o)},"×",8,Zt)]))),128))])]),e("div",St,[t[26]||(t[26]=e("label",null,"难度级别",-1)),e("div",$t,[(i(),n(w,null,M(U,s=>e("label",{key:s.value,class:st(["difficulty-option",{active:a.value.difficulty===s.value}])},[I(e("input",{type:"radio",value:s.value,"onUpdate:modelValue":t[14]||(t[14]=o=>a.value.difficulty=o),name:"difficulty",hidden:""},null,8,At),[[lt,a.value.difficulty]]),e("span",Ht,b(s.icon),1),e("span",Wt,b(s.label),1)],2)),64))])])]),v.value?(i(),n("div",{key:0,class:"modal-overlay",onClick:t[18]||(t[18]=s=>v.value=!1)},[e("div",{class:"modal-container media-modal",onClick:t[17]||(t[17]=S(()=>{},["stop"]))},[e("div",xt,[t[27]||(t[27]=e("h2",null,"添加图片",-1)),e("button",{class:"close-btn",onClick:t[15]||(t[15]=s=>v.value=!1)},"×")]),e("div",Lt,[e("div",Pt,[t[28]||(t[28]=e("label",{for:"mediaUpload",class:"upload-label"},[e("span",{class:"upload-icon"},"📷"),e("span",null,"选择或拖放图片")],-1)),e("input",{type:"file",id:"mediaUpload",onChange:z,accept:"image/*",hidden:""},null,32)]),c.value?(i(),n("div",Rt,[e("img",{src:c.value,alt:"预览"},null,8,Ut)])):L("",!0),e("div",Dt,[t[29]||(t[29]=e("h3",null,"图片库",-1)),e("div",Gt,[(i(!0),n(w,null,M(D.value,(s,o)=>(i(),n("div",{key:o,class:"media-item",onClick:C=>E(s)},[e("img",{src:s,alt:"图片"},null,8,Vt)],8,Qt))),128))])])]),e("div",zt,[e("button",{class:"secondary-btn",onClick:t[16]||(t[16]=s=>v.value=!1)},"取消"),e("button",{class:"primary-btn",onClick:Y,disabled:!p.value&&!c.value}," 插入图片 ",8,Et)])])])):L("",!0)]))}},qt=F(Yt,[["__scopeId","data-v-b7fe172b"]]);export{qt as default};

import{_ as ie,j as r,y as de,c as N,k as re,a as l,b as e,x as R,w as U,g as B,r as ue,F as L,d as M,t as d,m as $,l as m,v as P,z as ce,q as z,A as ve,o as n,s as K,B as pe,n as fe}from"./index-DYN_J6N2.js";import{u as ke,a as me}from"./card-DfiZIG2I.js";import{u as ge}from"./study-CUwUs_JI.js";const _e={class:"deck-detail-container"},Ce={key:0,class:"loading-state"},be={key:1,class:"not-found"},De={class:"deck-header"},ye={class:"back-nav"},we={class:"deck-title-section"},he={class:"deck-actions"},Te={class:"deck-description"},xe={class:"deck-meta"},Se={class:"deck-tags"},Be={class:"deck-stats"},Le={class:"stat-item"},Me={class:"stat-value"},Pe={class:"stat-item"},Ve={class:"stat-value"},Ae={class:"stat-item"},Ie={class:"stat-value"},Ne={class:"cards-section"},Re={class:"section-header"},Ue={class:"card-actions"},$e={class:"search-bar"},ze={class:"sort-options"},Ee=["title"],Fe={key:0,class:"no-cards"},He={class:"empty-state"},qe={key:0},je={key:1},We={key:1,class:"cards-list"},Ge=["onClick"],Je={class:"card-front-preview"},Ke={class:"card-expand-icon"},Oe={class:"card-details"},Qe={class:"card-content"},Xe={class:"card-front"},Ye=["innerHTML"],Ze={class:"card-back"},et=["innerHTML"],tt={class:"card-meta"},st={class:"card-tags"},ot={key:0,class:"card-progress"},at={class:"progress-info"},lt={class:"progress-indicator"},nt={class:"card-actions-bar"},it=["onClick"],dt=["onClick"],rt=["onClick"],ut={class:"modal-content"},ct={class:"modal-body"},vt={class:"form-group"},pt={class:"form-group"},ft={class:"form-group"},kt={__name:"DeckDetail",setup(mt){const O=de(),E=ve(),F=ke(),v=me();ge();const H=r(!0),g=r(O.params.id),f=r(-1),_=r(""),C=r("created"),b=r("desc"),y=r([]),V=r(!1),A=r(!1),w=r(null),k=r({title:"",description:"",tags:[]}),h=r(""),u=N(()=>F.getDeckById(g.value)),D=N(()=>v.getCardsByDeck(g.value)),I=N(()=>{const o=new Date;let t=0,a=0;return D.value.forEach(s=>{const i=v.getCardProgress(s.id);i.dueDate?new Date(i.dueDate)<=o&&t++:t++,i.repetitions>=3&&i.easeFactor>2&&a++}),{total:D.value.length,due:t,mastered:a}});re(()=>{setTimeout(()=>{H.value=!1,u.value&&T()},300)});function Q(o){f.value===o?f.value=-1:f.value=o}function T(){if(!D.value)return;let o=[...D.value];if(_.value){const t=_.value.toLowerCase();o=o.filter(a=>a.front.toLowerCase().includes(t)||a.back.toLowerCase().includes(t)||a.tags.some(s=>s.toLowerCase().includes(t)))}j(o),y.value=o}function q(){j(y.value)}function j(o){o.sort((t,a)=>{let s,i;if(C.value==="created")s=new Date(t.createdAt).getTime(),i=new Date(a.createdAt).getTime();else if(C.value==="updated")s=new Date(t.updatedAt).getTime(),i=new Date(a.updatedAt).getTime();else if(C.value==="dueDate"){const c=v.getCardProgress(t.id),J=v.getCardProgress(a.id);s=c.dueDate?new Date(c.dueDate).getTime():0,i=J.dueDate?new Date(J.dueDate).getTime():0}return b.value==="asc"?s-i:i-s})}function X(){b.value=b.value==="asc"?"desc":"asc",q()}function W(){E.push({name:"NewCard",query:{deckId:g.value}})}function Y(o){E.push({name:"EditCard",params:{id:o.id}})}function Z(o){w.value=o,V.value=!0}function x(){w.value=null,V.value=!1}function ee(){w.value&&(v.deleteCard(w.value.id),x(),T())}function te(){u.value&&(k.value={title:u.value.title,description:u.value.description,tags:[...u.value.tags]},h.value=u.value.tags.join(", "),A.value=!0)}function S(){A.value=!1}function se(){const o=h.value.split(",").map(a=>a.trim()).filter(a=>a),t={...k.value,tags:o};F.updateDeck(g.value,t),S()}function p(o){return v.getCardProgress(o)}function oe(o){confirm("确定要重置这张卡片的学习进度吗？")&&(v.resetCardProgress(o),T())}function ae(o){const t=p(o);return t.repetitions?t.repetitions>=5?100:t.repetitions*20:0}function le(o){const t=p(o);return t.repetitions>=3?"progress-good":t.repetitions>=1?"progress-medium":"progress-poor"}function G(o){return o?new Date(o).toLocaleDateString("zh-CN"):"未学习"}function ne(o,t){const a=o.replace(/<[^>]*>/g,"");return a.length<=t?a:a.substring(0,t)+"..."}return(o,t)=>{const a=ue("router-link");return n(),l("div",_e,[H.value?(n(),l("div",Ce,t[5]||(t[5]=[e("div",{class:"spinner"},null,-1),e("p",null,"加载中...",-1)]))):u.value?(n(),l(L,{key:2},[e("div",De,[e("div",ye,[R(a,{to:"/decks",class:"back-link"},{default:U(()=>t[9]||(t[9]=[B(" ← 返回卡片集列表 ")])),_:1})]),e("div",we,[e("h1",null,d(u.value.title),1),e("div",he,[e("button",{class:"edit-btn",onClick:te},"编辑卡片集"),R(a,{to:`/study/${g.value}`,class:"study-btn"},{default:U(()=>t[10]||(t[10]=[B(" 开始学习 ")])),_:1},8,["to"])])]),e("p",Te,d(u.value.description),1),e("div",xe,[e("div",Se,[(n(!0),l(L,null,$(u.value.tags,s=>(n(),l("span",{key:s,class:"tag"},d(s),1))),128))]),e("div",Be,[e("div",Le,[e("span",Me,d(I.value.total),1),t[11]||(t[11]=e("span",{class:"stat-label"},"总卡片",-1))]),e("div",Pe,[e("span",Ve,d(I.value.due),1),t[12]||(t[12]=e("span",{class:"stat-label"},"待复习",-1))]),e("div",Ae,[e("span",Ie,d(I.value.mastered),1),t[13]||(t[13]=e("span",{class:"stat-label"},"已掌握",-1))])])])]),e("div",Ne,[e("div",Re,[e("h2",null,"卡片 ("+d(D.value.length)+")",1),e("button",{class:"add-card-btn",onClick:W},t[14]||(t[14]=[e("span",{class:"icon"},"+",-1),B(" 添加卡片 ")]))]),e("div",Ue,[e("div",$e,[m(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),placeholder:"搜索卡片...",onInput:T},null,544),[[P,_.value]])]),e("div",ze,[t[16]||(t[16]=e("label",{for:"sortBy"},"排序方式:",-1)),m(e("select",{id:"sortBy","onUpdate:modelValue":t[1]||(t[1]=s=>C.value=s),onChange:q},t[15]||(t[15]=[e("option",{value:"created"},"创建时间",-1),e("option",{value:"updated"},"更新时间",-1),e("option",{value:"dueDate"},"到期时间",-1)]),544),[[ce,C.value]]),e("button",{class:"sort-direction-btn",onClick:X,title:b.value==="asc"?"升序":"降序"},d(b.value==="asc"?"↑":"↓"),9,Ee)])]),y.value.length===0?(n(),l("div",Fe,[e("div",He,[t[17]||(t[17]=e("div",{class:"empty-icon"},"🃏",-1)),t[18]||(t[18]=e("h3",null,"暂无卡片",-1)),_.value?(n(),l("p",qe,"没有符合搜索条件的卡片")):(n(),l("p",je,'点击"添加卡片"按钮开始创建')),e("button",{class:"add-card-btn",onClick:W},"添加卡片")])])):(n(),l("div",We,[(n(!0),l(L,null,$(y.value,(s,i)=>(n(),l("div",{key:s.id,class:K(["card-item",{expanded:f.value===i}])},[e("div",{class:"card-header",onClick:c=>Q(i)},[e("div",Je,d(ne(s.front,80)),1),e("div",Ke,d(f.value===i?"▼":"▶"),1)],8,Ge),m(e("div",Oe,[e("div",Qe,[e("div",Xe,[t[19]||(t[19]=e("h4",null,"问题",-1)),e("div",{innerHTML:s.front},null,8,Ye)]),e("div",Ze,[t[20]||(t[20]=e("h4",null,"答案",-1)),e("div",{innerHTML:s.back},null,8,et)])]),e("div",tt,[e("div",st,[(n(!0),l(L,null,$(s.tags,c=>(n(),l("span",{key:c,class:"tag"},d(c),1))),128))]),p(s.id).lastReviewed?(n(),l("div",ot,[e("div",at,[e("div",null,"上次复习: "+d(G(p(s.id).lastReviewed)),1),e("div",null,"下次复习: "+d(G(p(s.id).dueDate)),1),e("div",null,"复习次数: "+d(p(s.id).repetitions),1)]),e("div",lt,[e("div",{class:K(["progress-bar",le(s.id)]),style:fe({width:ae(s.id)+"%"})},null,6)])])):M("",!0)]),e("div",nt,[e("button",{class:"edit-card-btn",onClick:c=>Y(s)},"编辑卡片",8,it),e("button",{class:"delete-card-btn",onClick:c=>Z(s)},"删除卡片",8,dt),p(s.id).lastReviewed?(n(),l("button",{key:0,class:"reset-card-btn",onClick:c=>oe(s.id)}," 重置进度 ",8,rt)):M("",!0)])],512),[[pe,f.value===i]])],2))),128))]))]),V.value?(n(),l("div",{key:0,class:"modal",onClick:z(x,["self"])},[e("div",{class:"modal-content delete-confirm"},[e("div",{class:"modal-header"},[t[21]||(t[21]=e("h2",null,"确认删除",-1)),e("button",{class:"close-btn",onClick:x},"×")]),e("div",{class:"modal-body"},[t[22]||(t[22]=e("p",null,"确定要删除这张卡片吗？",-1)),t[23]||(t[23]=e("p",{class:"warning"},"此操作不可撤销！",-1)),e("div",{class:"form-actions"},[e("button",{class:"cancel-btn",onClick:x},"取消"),e("button",{class:"delete-btn",onClick:ee},"确认删除")])])])])):M("",!0),A.value?(n(),l("div",{key:1,class:"modal",onClick:z(S,["self"])},[e("div",ut,[e("div",{class:"modal-header"},[t[24]||(t[24]=e("h2",null,"编辑卡片集",-1)),e("button",{class:"close-btn",onClick:S},"×")]),e("div",ct,[e("form",{onSubmit:z(se,["prevent"])},[e("div",vt,[t[25]||(t[25]=e("label",{for:"deckTitle"},"标题",-1)),m(e("input",{type:"text",id:"deckTitle","onUpdate:modelValue":t[2]||(t[2]=s=>k.value.title=s),required:"",placeholder:"输入卡片集标题"},null,512),[[P,k.value.title]])]),e("div",pt,[t[26]||(t[26]=e("label",{for:"deckDescription"},"描述",-1)),m(e("textarea",{id:"deckDescription","onUpdate:modelValue":t[3]||(t[3]=s=>k.value.description=s),rows:"3",placeholder:"简要描述这个卡片集的内容"},null,512),[[P,k.value.description]])]),e("div",ft,[t[27]||(t[27]=e("label",{for:"deckTags"},"标签 (用逗号分隔)",-1)),m(e("input",{type:"text",id:"deckTags","onUpdate:modelValue":t[4]||(t[4]=s=>h.value=s),placeholder:"例如: 语言,编程,历史"},null,512),[[P,h.value]])]),e("div",{class:"form-actions"},[e("button",{type:"button",class:"cancel-btn",onClick:S},"取消"),t[28]||(t[28]=e("button",{type:"submit",class:"save-btn"},"保存",-1))])],32)])])])):M("",!0)],64)):(n(),l("div",be,[t[7]||(t[7]=e("h2",null,"未找到卡片集",-1)),t[8]||(t[8]=e("p",null,"您请求的卡片集不存在或已被删除",-1)),R(a,{to:"/decks",class:"back-link"},{default:U(()=>t[6]||(t[6]=[B("返回卡片集列表")])),_:1})]))])}}},bt=ie(kt,[["__scopeId","data-v-2d36f669"]]);export{bt as default};
